# Copyright (c) Omar Boukli-Hacene. All rights reserved.
# Distributed under an MIT-style license that can be
# found in the LICENSE file.

# SPDX-License-Identifier: MIT

trigger:
  branches:
    include:
      - "*"

strategy:
  matrix:
    linux_node_maintenance:
      imageName: ubuntu-latest
      node_version: 16.x
    linux_node_lts:
      imageName: ubuntu-latest
      node_version: 18.x
    linux_node_current:
      imageName: ubuntu-latest
      node_version: 19.x
    macos_node_lts:
      imageName: macOS-latest
      node_version: 18.x
    windows_node_lts:
      imageName: windows-latest
      node_version: 18.x

pool:
  vmImage: $(imageName)

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: $(node_version)
    displayName: Set up Node.js

  - script: npm install -g npm@latest
    displayName: Update NPM

  - script: npm --version
    displayName: NPM version

  - script: npm ci
    displayName: Install packages

  - script: npm run build
    displayName: Build

  - script: npm test
    displayName: Run tests

  - script: npx -- montehall --version
    displayName: Run smoke test
